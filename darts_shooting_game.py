def darts_shooting(dex, spd):
    import streamlit as st
    from datetime import datetime, timezone, timedelta
    import random

    # æ—¥ä»˜ã‚·ã‚¹ãƒ†ãƒ 
    JST = timezone(timedelta(hours=9))
    today = datetime.now(JST).date()

    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã§æ—¥ä»˜ã¨ãƒ—ãƒ¬ã‚¤å›æ•°ã‚’ä¿æŒ
    if "last_play_date" not in st.session_state:
        st.session_state["last_play_date"] = None
        st.session_state["play_count"] = 0

    # æ—¥ä»˜ãŒå¤‰ã‚ã£ãŸå ´åˆã«ãƒªã‚»ãƒƒãƒˆ
    if st.session_state["last_play_date"] != today:
        st.session_state["last_play_date"] = today
        st.session_state["play_count"] = 0

    # ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«ã®è¡¨ç¤º
# ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«ã®è¡¨ç¤º
    st.markdown("""
    <div style="text-align: center;">
        <h3 style="font-size:20px;">ğŸ¯ ãƒ€ãƒ¼ãƒ„ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ğŸ¯</h3>
    </div>
""", unsafe_allow_html=True)
    st.markdown('<h4 style="font-size:16px;">ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«</h4>', unsafe_allow_html=True)
    st.write("""
    1. **åŸºæœ¬å¾—ç‚¹**: ãƒ€ã‚¤ã‚¹ï¼ˆ1d6ï¼‰ã‚’æŒ¯ã£ã¦å‡ºç›®ã«å¿œã˜ãŸå¾—ç‚¹ã‚’è¨ˆç®—ã—ã¾ã™ã€‚  
       - å‡ºç›® 1ï½2: 10ç‚¹ï¼ˆã‚·ãƒ³ã‚°ãƒ«ï¼‰  
       - å‡ºç›® 3ï½4: 15ç‚¹ï¼ˆãƒ€ãƒ–ãƒ«ï¼‰  
       - å‡ºç›® 5ï½6: 20ç‚¹ï¼ˆãƒˆãƒªãƒ—ãƒ«ï¼‰  
       - å‘½ä¸­ç²¾åº¦ã§ã®æ˜‡æ ¼ã®ã¿: 30ç‚¹ï¼ˆãƒ–ãƒ«ï¼‰  
    2. **å‘½ä¸­ç²¾åº¦ï¼ˆDEXåˆ¤å®šï¼‰**: ã€DEXã€‘+1d10ã§åˆ¤å®šã—ã€å¾—ç‚¹ã‚’è¿½åŠ /æ˜‡æ ¼ã—ã¾ã™ã€‚  
       - é›£æ˜“åº¦15: 1æ®µéšæ˜‡æ ¼ï¼ˆä¾‹: ã‚·ãƒ³ã‚°ãƒ«â†’ãƒ€ãƒ–ãƒ«ã€ãƒˆãƒªãƒ—ãƒ«â†’ãƒ–ãƒ«ï¼‰  
       - é›£æ˜“åº¦20: 2æ®µéšæ˜‡æ ¼ï¼ˆä¾‹: ã‚·ãƒ³ã‚°ãƒ«â†’ãƒ€ãƒ–ãƒ«â†’ãƒˆãƒªãƒ—ãƒ«ï¼‰  
       - é›£æ˜“åº¦25: 3æ®µéšæ˜‡æ ¼ï¼ˆä¾‹: ã‚·ãƒ³ã‚°ãƒ«â†’ãƒ€ãƒ–ãƒ«â†’ãƒˆãƒªãƒ—ãƒ«â†’ãƒ–ãƒ«ï¼‰  
       - æ—¢ã«ãƒ–ãƒ«ï¼ˆ30ç‚¹ï¼‰ã®å ´åˆã€1æ®µéšã«ã¤ã+10ç‚¹ãšã¤åŠ ç‚¹  
    3. **ã‚¹ãƒ”ãƒ¼ãƒ‰ï¼ˆSPDåˆ¤å®šï¼‰**: ã€SPDã€‘+1d10ã§åˆ¤å®šã—ã€å¾—ç‚¹å€ç‡ã‚’æ±ºå®šã—ã¾ã™ã€‚  
       - é›£æ˜“åº¦15: Ã—2  
       - é›£æ˜“åº¦20: Ã—3  
       - é›£æ˜“åº¦25: Ã—5  
    4. **çµ„ã¿åˆã‚ã›ãƒœãƒ¼ãƒŠã‚¹**: ã€DEXã€‘ã¨ã€SPDã€‘ã®åˆ¤å®šãŒä¸¡æ–¹20ä»¥ä¸Šã®å ´åˆã€+10ç‚¹ã€‚  
    """)

    # ãƒ—ãƒ¬ã‚¤å›æ•°ã®è¡¨ç¤º
    st.write(f"æœ¬æ—¥ãƒ—ãƒ¬ã‚¤æ¸ˆã¿å›æ•°: {st.session_state['play_count']}å›")
    st.write("å„ã‚²ãƒ¼ãƒ 1æ—¥ã«1å›ã®ã¿ãƒ—ãƒ¬ã‚¤å¯èƒ½ã§ã™ã€‚")

    # ãƒ—ãƒ¬ã‚¤å‡¦ç†
    if st.session_state["play_count"] < 4 and st.button("ãƒ—ãƒ¬ã‚¤ã™ã‚‹", key="darts_shooting_play_button"):
    # åŸºæœ¬å¾—ç‚¹ã®åˆ¤å®šï¼ˆå‡ºç›®ã«å¿œã˜ã¦éšå±¤ã‚’å‰²ã‚Šå½“ã¦ï¼‰
       base_roll = random.randint(1, 6)
    if base_roll <= 2:
        base_score = 10
        level = 0
        zone = "ã‚·ãƒ³ã‚°ãƒ«"
    elif base_roll <= 4:
        base_score = 15
        level = 1
        zone = "ãƒ€ãƒ–ãƒ«"
    else:
        base_score = 20
        level = 2
        zone = "ãƒˆãƒªãƒ—ãƒ«"

        # åŸºç¤å¾—ç‚¹ã‚’è¡¨ç¤º
        st.subheader("ğŸ¯ çµæœ")
        st.write(f"å‡ºç›®: {base_roll} â†’ åŸºç¤å¾—ç‚¹: {base_score}ç‚¹ï¼ˆ{zone}ï¼‰")

        # DEXåˆ¤å®š
        dex_random = random.randint(1, 10)
        dex_roll = dex + dex_random
        st.write(f"DEXåˆ¤å®š: {dex} + 1d10({dex_random}) â†’ {dex_roll}")

        # DEXã«ã‚ˆã‚‹æ˜‡æ ¼æ®µéšæ•°ã®æ±ºå®š
        upgrade = 0
        if 15 <= dex_roll < 20:
            upgrade = 1
        elif 20 <= dex_roll < 25:
            upgrade = 2
        elif dex_roll >= 25:
            upgrade = 3

        # æ˜‡æ ¼å‡¦ç†
        if level < 3:
            new_level = min(level + upgrade, 3)
            level = new_level
            base_score = [10, 15, 20, 30][level]
        else:
            # æ—¢ã«ãƒ–ãƒ«ã®å ´åˆã¯+10ç‚¹ãšã¤åŠ ç®—
            base_score += 10 * upgrade

        # ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸãƒ©ãƒ™ãƒ«
        zone_labels = ["ã‚·ãƒ³ã‚°ãƒ«", "ãƒ€ãƒ–ãƒ«", "ãƒˆãƒªãƒ—ãƒ«", "ãƒ–ãƒ«"]
        zone = zone_labels[level]
        st.write(f"æ˜‡æ ¼å¾Œå¾—ç‚¹: {base_score}ç‚¹ï¼ˆ{zone}ï¼‰")

        # æ˜‡æ ¼å¾Œå¾—ç‚¹ã®ãƒ©ãƒ™ãƒ«ä»˜ã‘
        if base_score == 10:
            final_zone = "å¤–å‘¨"
        elif base_score == 15:
            final_zone = "ä¸­é–“"
        elif base_score == 20 or base_score == 25:
            final_zone = "ä¸­å¿ƒ"
        elif base_score == 30:
            final_zone = "ä¸­å¿ƒ+"
        elif base_score == 40:
            final_zone = "ä¸­å¿ƒ++"
        else:
            final_zone = "ä¸æ˜"

        st.write(f"æ˜‡æ ¼å¾Œå¾—ç‚¹: {base_score}ç‚¹ï¼ˆ{final_zone}ï¼‰")

        # SPDåˆ¤å®š
        spd_random = random.randint(1, 10)  # 1d10ã®çµæœ
        spd_roll = spd + spd_random
        multiplier = 1
        if spd_roll >= 15:
            multiplier = 2
        if spd_roll >= 20:
            multiplier = 3
        if spd_roll >= 25:
            multiplier = 5
        st.write(f"SPDåˆ¤å®š: {spd} + 1d10({spd_random}) â†’ {spd_roll} â†’ å€ç‡: Ã—{multiplier}")

        # çµ„ã¿åˆã‚ã›ãƒœãƒ¼ãƒŠã‚¹
        combo_bonus = 10 if dex_roll >= 20 and spd_roll >= 20 else 0
        st.write(f"çµ„ã¿åˆã‚ã›ãƒœãƒ¼ãƒŠã‚¹: +{combo_bonus}ç‚¹")

        # æœ€çµ‚å¾—ç‚¹è¨ˆç®—
        final_score = base_score * multiplier + combo_bonus
        st.write(f"æœ€çµ‚å¾—ç‚¹: **{final_score}ç‚¹**")

        # ãƒ¢ãƒãƒ«ãƒ³ã®ã‚³ãƒ¡ãƒ³ãƒˆ
        if final_score <= 20:
            st.write("ãƒ€ãƒ¼ãƒ„ãŒãƒ›ãƒ­ã‚°ãƒ©ãƒ ã®çš„ã‚’ã‹ã™ã‚ã€è™šã—ãå®™ã‚’èˆã†ã€‚çš„ã®èµ¤ã„è­¦å‘Šãƒ©ã‚¤ãƒˆãŒç‚¹æ»…ã—ã€æ©Ÿæ¢°çš„ãªã€Œã‚¨ãƒ©ãƒ¼ã€ã®å£°ãŒéŸ¿ãã€‚")
            st.write("ã€çµæœ: ä½å¾—ç‚¹ã‚¾ãƒ¼ãƒ³ã€‚å†è¨ˆç®—ã®å¿…è¦æ€§: 0%ã€‚ã“ã®è¨˜éŒ²ã¯ã€å‰Šé™¤ã™ã¹ãã§ã—ã‚‡ã†ã‹ï¼Ÿã€")
        elif final_score <= 40:
            st.write("ãƒ€ãƒ¼ãƒ„ãŒé…ã‚Œã¦æ”¾ãŸã‚Œã€ãƒ›ãƒ­ã‚°ãƒ©ãƒ ã®çš„ã«ã‹ã‚ã†ã˜ã¦å‘½ä¸­ã€‚é’ã„å…‰ãŒä¸€ç¬ã ã‘ç‚¹æ»…ã—ã€é™ã‹ã«æ¶ˆãˆãŸã€‚")
            st.write("ã€å¹³å‡ä»¥ä¸‹ã€‚ã‚ãªãŸã®ã‚¹ã‚³ã‚¢ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åŸºæº–ã‚’ä¸‹å›ã£ã¦ã„ã¾ã™ã€‚ãƒ¢ãƒãƒ«ãƒ³ã¯åŠªåŠ›ã‚’æ­“è¿ã—ã¾ã™ãŒã€é€²å±•ã¯ç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã€")
        elif final_score <= 60:
            st.write("å‹•ãçš„ã®ä¸­é–“ã«ãƒ€ãƒ¼ãƒ„ãŒã—ã£ã‹ã‚Šåˆºã•ã‚‹ã€‚ç·‘è‰²ã®ãƒ©ã‚¤ãƒˆãŒç‚¹ç¯ã—ã€å¿ƒåœ°ã‚ˆã„éŸ³æ¥½ãŒçŸ­ãæµã‚ŒãŸã€‚")
            st.write("ã€çµæœ: å®‰å®šã—ãŸã‚¹ã‚³ã‚¢ã§ã™ã€‚ãŸã ã—ã€ãƒ¢ãƒãƒ«ãƒ³ã®åŸºæº–ã§ã¯â€œç‰¹åˆ¥â€ã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚æœªæ¥ã®æŒ‘æˆ¦è€…ã¨ã—ã¦é€²åŒ–ã™ã‚‹å¯èƒ½æ€§ã«æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚ã€")
        elif final_score <= 90:
            st.write("ãƒ€ãƒ¼ãƒ„ãŒé«˜é€Ÿã§é£›ã³ã€çš„ã®ä¸­å¿ƒã«å¯¸åˆ†é•ã‚ãšå‘½ä¸­ã€‚é‡‘è‰²ã®å…‰ãŒçš„ã‚’åŒ…ã¿ã€è¦³å®¢ã®æ­“å£°ã‚’å†ç¾ã™ã‚‹éŸ³ãŒæµã‚Œã‚‹ã€‚")
            st.write("ã€å„ªç§€ãªçµæœã€‚ã‚ãªãŸã®æˆé•·æ›²ç·šã¯éå¸¸ã«èˆˆå‘³æ·±ã„ã§ã™ã€‚æ¬¡ã‚‚åŒæ§˜ã®çµæœã‚’æœŸå¾…ã—ã¾ã™ã€‚ã€")
        else:
            st.write("ã€é©šç•°çš„ãªã‚¹ã‚³ã‚¢ã§ã™ã€‚ãƒ¢ãƒãƒ«ãƒ³ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ›¸ãæ›ãˆã‚’é–‹å§‹ã—ã¾ã™ã€‚")
            st.write("ãŠã£ã¨ã€æ›¸ãæ›ãˆé€Ÿåº¦ãŒé…ã„ï¼Ÿãã‚Œã‚‚ãã®ã¯ãšã€ã“ã‚“ãªè¨˜éŒ²ã¯äºˆå®šå¤–ã ã£ãŸã®ã§ã™ã‹ã‚‰ï¼ã€")
            st.write("ãƒ›ãƒ­ã‚°ãƒ©ãƒ ãƒ€ãƒ¼ãƒ„ãŒå®Œç’§ãªè»Œé“ã§å‘½ä¸­ã™ã‚‹ã€‚è™¹è‰²ã«å…‰ã‚‹ç”»é¢ã€æ´¾æ‰‹ãªæ¼”å‡ºã¨ç¥è³€éŸ³æ¥½ã®ä¸­ã§ã€ãƒ¢ãƒãƒ«ãƒ³ã¯è¸Šã£ã¦ã„ãŸã€‚")

        # ãƒ—ãƒ¬ã‚¤å›æ•°ã‚’å¢—ã‚„ã™
        st.session_state["play_count"] += 1
        st.success("ãƒ—ãƒ¬ã‚¤ã—ã¾ã—ãŸï¼æ¬¡ã®æ—¥ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚")
    elif st.session_state["play_count"] >= 4:
        st.error("æœ¬æ—¥ã®ãƒ—ãƒ¬ã‚¤å›æ•°ã‚’è¶…ãˆã¾ã—ãŸã€‚")
