def hologram_slot(dex, pow_stat):
    import streamlit as st
    from datetime import datetime, timezone, timedelta
    import random

        # æ—¥ä»˜ã‚·ã‚¹ãƒ†ãƒ ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰
    JST = timezone(timedelta(hours=9))
    today = datetime.now(JST).date()

        # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã§æ—¥ä»˜ã¨ãƒ—ãƒ¬ã‚¤å›æ•°ã‚’ä¿æŒ
    if "last_play_date" not in st.session_state:
        st.session_state["last_play_date"] = None
        st.session_state["play_count"] = 0

        # æ—¥ä»˜ãŒå¤‰ã‚ã£ãŸå ´åˆã«ãƒªã‚»ãƒƒãƒˆ
    if st.session_state["last_play_date"] != today:
        st.session_state["last_play_date"] = today
        st.session_state["play_count"] = 0

        # ã‚¹ãƒ­ãƒƒãƒˆå‡ºç›®ã«å¯¾å¿œã™ã‚‹çµµæ–‡å­—
    slot_emojis = {
            1: "ğŸª",  # æƒ‘æ˜Ÿ
            2: "ğŸš€",  # ãƒ­ã‚±ãƒƒãƒˆ
            3: "ğŸŒŸ",  # æ˜Ÿ
            4: "ğŸ›¸",  # UFO
            5: "ğŸ’",  # ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰
            6: "ğŸŒŒ",  # éŠ€æ²³
    }

    # ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«ã®è¡¨ç¤º
    st.markdown("""
        <div style="text-align: center;">
        <h3 style="font-size:20px;">ğŸ”® ãƒ›ãƒ­ã‚°ãƒ©ãƒ ã‚¹ãƒ­ãƒƒãƒˆ ğŸ”®</h3>
        </div>
	""", unsafe_allow_html=True)
    st.markdown('<h4 style="font-size:16px;">ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«</h4>', unsafe_allow_html=True)
    st.write("""
    1. **ã‚¹ãƒ­ãƒƒãƒˆå‡ºç›®**: ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ3d6ï¼‰ã‚’æ­¢ã‚ã¦å‡ºç›®ï¼ˆçµµæŸ„ï¼‰ã«å¿œã˜ãŸå¾—ç‚¹ã‚’è¨ˆç®—ã—ã¾ã™ã€‚  
       - å‡ºç›®ã®çµµæŸ„ã«å¿œã˜ã¦åˆæœŸåˆè¨ˆãŒè¨ˆç®—ã•ã‚Œã¾ã™
       - ï¼ˆä¾‹: å‡ºç›® ğŸª(1) | ğŸŒŸ(3) | ğŸŒŒ(6) â†’ åˆè¨ˆ 10ç‚¹ï¼‰ã€‚
    2. **ç›®æŠ¼ã—åˆ¤å®šï¼ˆDEXï¼‰**  
       - ã€DEXã€‘+1d10ã§ç›®æŠ¼ã—ã‚’åˆ¤å®šã—ã€æˆåŠŸã«å¿œã˜ã¦å‡ºç›®ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚  
       - é›£æ˜“åº¦15: å‡ºç›®1ã¤ã‚’å¤‰æ›´ï¼ˆã‚¾ãƒ­ç›®å„ªå…ˆï¼‰ã€‚  
       - é›£æ˜“åº¦20: å‡ºç›®2ã¤ã‚’å¤‰æ›´ï¼ˆã‚¾ãƒ­ç›®å„ªå…ˆï¼‰ã€‚  
       - é›£æ˜“åº¦25: å‡ºç›®3ã¤ã‚’å¤‰æ›´ï¼ˆã‚¾ãƒ­ç›®ç¢ºå®šï¼‰ã€‚
    3. **ã‚¾ãƒ­ç›®ãƒœãƒ¼ãƒŠã‚¹**  
        - ã™ã¹ã¦åŒã˜å‡ºç›®ï¼ˆã‚¾ãƒ­ç›®ï¼‰ã®å ´åˆã€åˆè¨ˆå¾—ç‚¹ãŒ**2å€**ã«ãªã‚Š+10ç‚¹ã®ãƒœãƒ¼ãƒŠã‚¹ãŒåŠ ç®—ã•ã‚Œã¾ã™ã€‚
    4. **ç²¾ç¥é›†ä¸­åˆ¤å®šï¼ˆPOWï¼‰**  
       - ã€POWã€‘+1d10ã§åˆ¤å®šã‚’è¡Œã„ã€æœ€çµ‚å¾—ç‚¹ã«å€ç‡ã‚’é©ç”¨ã—ã¾ã™ã€‚  
       - é›£æ˜“åº¦20: æœ€çµ‚å¾—ç‚¹Ã—2  
       - é›£æ˜“åº¦25: æœ€çµ‚å¾—ç‚¹Ã—3
        5. **å¾—ç‚¹è¨ˆç®—å¼**  
       - æœ€çµ‚å¾—ç‚¹ = (ã‚¾ãƒ­ç›®ãƒœãƒ¼ãƒŠã‚¹é©ç”¨å¾Œã®å¾—ç‚¹) Ã— POWåˆ¤å®šå€ç‡
        """)

        # ãƒ—ãƒ¬ã‚¤å›æ•°ã®è¡¨ç¤º
    st.write(f"æœ¬æ—¥ãƒ—ãƒ¬ã‚¤æ¸ˆã¿å›æ•°: {st.session_state['play_count']}å›")
    st.write("å„ã‚²ãƒ¼ãƒ 1æ—¥ã«1å›ã®ã¿ãƒ—ãƒ¬ã‚¤å¯èƒ½ã§ã™ã€‚")

        # ãƒ—ãƒ¬ã‚¤å‡¦ç†
    if st.session_state["play_count"] < 4 and st.button("ãƒ—ãƒ¬ã‚¤ã™ã‚‹", key="hologram_slot_play_button"):
            # ã‚¹ãƒ­ãƒƒãƒˆã®åˆæœŸå‡ºç›®ã‚’æ±ºå®š
            slot_rolls = [random.randint(1, 6) for _ in range(3)]  # ã‚¹ãƒ­ãƒƒãƒˆå‡ºç›®
            
            # çµµæ–‡å­—ã§å‡ºç›®ã‚’è¡¨ç¤º
            st.subheader("ã‚¹ãƒ­ãƒƒãƒˆã®çµæœ")
            slot_emoji_display = " | ".join([slot_emojis[roll] for roll in slot_rolls])
            st.write(f"çµæœ: {slot_emoji_display}")
            st.write(f"åˆæœŸåˆè¨ˆ: {sum(slot_rolls)}")
            
            # ç›®æŠ¼ã—ï¼ˆDEXåˆ¤å®šï¼‰
            dex_roll = random.randint(1, 10)
            dex_total = dex + dex_roll
            st.write(f"ç›®æŠ¼ã—åˆ¤å®šï¼ˆDEXåˆ¤å®šï¼‰: {dex} + 1d10({dex_roll}) â†’ {dex_total}")
            
            # ç›®æŠ¼ã—ã«ã‚ˆã‚‹å‡ºç›®å¤‰æ›´ï¼ˆã‚¾ãƒ­ç›®å„ªå…ˆï¼‹é«˜å¾—ç‚¹å„ªå…ˆï¼‰
            changeable = 0
            if dex_total >= 15 and dex_total < 20:
                changeable = 1
            elif dex_total >= 20 and dex_total < 25:
                changeable = 2
            elif dex_total >= 25:
                # å¼·åˆ¶æœ€å¤§ã‚¾ãƒ­ç›®
                slot_rolls = [6, 6, 6]
                st.write(f"ç›®æŠ¼ã—åæ˜ å¾Œ: {' | '.join([slot_emojis[roll] for roll in slot_rolls])} â†’ åˆè¨ˆ: {sum(slot_rolls)}")
            if 0 < changeable < 3:
                candidates = []
                for t in range(1, 7):
                    count = slot_rolls.count(t)
                    needed = 3 - count
                    if needed <= changeable:
                        candidates.append((t, needed))
                if candidates:
                    best_target = max(candidates, key=lambda x: x[0])  # å€¤ã®å¤§ãã„ã‚¾ãƒ­ç›®ã‚’å„ªå…ˆ
                    slot_rolls = [best_target[0]] * 3
                st.write(f"ç›®æŠ¼ã—åæ˜ å¾Œ: {' | '.join([slot_emojis[roll] for roll in slot_rolls])} â†’ åˆè¨ˆ: {sum(slot_rolls)}")
                        
            # ã‚¾ãƒ­ç›®ãƒœãƒ¼ãƒŠã‚¹åˆ¤å®š
            if len(set(slot_rolls)) == 1:
                base_score = sum(slot_rolls) * 2 + 10
                st.write("âœ¨ ã‚¾ãƒ­ç›®ãƒœãƒ¼ãƒŠã‚¹é©ç”¨ï¼å¾—ç‚¹ãŒå€å¢—ã— +10 ç‚¹åŠ ç®—ï¼ âœ¨")
            else:
                base_score = sum(slot_rolls)
            
            # ã€POWã€‘åˆ¤å®š: ç²¾ç¥é›†ä¸­
            pow_roll = random.randint(1, 10)
            pow_total = pow_stat + pow_roll
            st.write(f"ç²¾ç¥é›†ä¸­åˆ¤å®šï¼ˆPOWåˆ¤å®šï¼‰: {pow_stat} + 1d10({pow_roll}) â†’ {pow_total}")
            
            # POWåˆ¤å®šã«ã‚ˆã‚‹å€ç‡é©ç”¨
            multiplier = 1
            if pow_total >= 20 and pow_total < 25:
                multiplier = 2
            elif pow_total >= 25:
                multiplier = 3
            final_score = base_score * multiplier
            
            st.write(f"å¾—ç‚¹è¨ˆç®—å¼: {' + '.join(map(str, slot_rolls))} â†’ {base_score}ç‚¹ â†’ Ã—{multiplier}å€")
            
            st.subheader("ğŸ° æœ€çµ‚çµæœ ğŸ°")
            st.write(f"æœ€çµ‚å¾—ç‚¹: **{final_score}ç‚¹**")
            
            # ãƒ¢ãƒãƒ«ãƒ³ã®ã‚³ãƒ¡ãƒ³ãƒˆ
            if final_score <= 20:
                st.write("ã‚¹ãƒ­ãƒƒãƒˆãŒåœæ­¢ã—ã€å…¨çµµæŸ„ãŒæ¶ˆãˆç”»é¢ãŒæš—è»¢ã€‚èµ¤ã„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç‚¹æ»…ã—ã€é ãã§è­¦å‘ŠéŸ³ãŒé³´ã‚ŠéŸ¿ãã€‚")
                st.write("ã€ãƒ¢ãƒãƒ«ãƒ³ã¯å†·é™ã«ãŠä¼ãˆã—ã¾ã™ã€‚ã“ã®çµæœã¯çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã«æ®‹ã™ä¾¡å€¤ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚ã€")
            elif final_score <= 40:
                st.write("ã‚¹ãƒ­ãƒƒãƒˆãŒã‚†ã£ãã‚Šæ­¢ã¾ã‚‹ã€‚æ•£ã‚‰ã°ã£ãŸæƒ‘æ˜Ÿã¨ç ´æã—ãŸå®‡å®™èˆ¹ã€‚é’ã„å…‰ãŒå¾®ã‹ã«æºã‚Œã€å¤±æ•—ã‚’ç¤ºã™é›»å­éŸ³ãŒéŸ¿ã„ãŸã€‚")
                st.write("ã€çµæœç¢ºèªå®Œäº†ã€‚ã‚¹ã‚³ã‚¢ã¯ä½ç©ºé£›è¡Œã€å®‡å®™èˆ¹ã¯å¢œè½ã€æƒ‘æ˜Ÿã¯å´©å£Šã€‚ãƒ¢ãƒãƒ«ãƒ³ã¨ã—ã¦ã¯æœŸå¾…å€¤æœªæº€ã®çµæœã«è»½ãå¤±æœ›ã—ã¦ã„ã¾ã™ã€‚ã€")
            elif final_score <= 60:
                st.write("ã‚¹ãƒ­ãƒƒãƒˆãŒå›è»¢ã‚’æ­¢ã‚ã‚‹ã¨ã€ãƒ›ãƒ­ã‚°ãƒ©ãƒ ã«è¼ãæƒ‘æ˜Ÿã¨å®‡å®™èˆ¹ãŒä¸¦ã³ç¾ã‚Œã‚‹ã€‚ç©ã‚„ã‹ãªèƒŒæ™¯éŸ³æ¥½ãŒæµã‚Œå§‹ã‚ãŸã€‚")
                st.write("ã€ã‚¹ãƒ­ãƒƒãƒˆã®åœæ­¢ã‚’ç¢ºèªã€‚çµ±è¨ˆçš„ã«ã¯ç„¡é›£ãªã‚¹ã‚³ã‚¢ã§ã™ãŒã€éŠ€æ²³ã®ç‰‡éš…ã§ã²ã£ãã‚Šã¨è¼ãæ˜Ÿã®ã‚ˆã†ãªæ§ãˆã‚ãªçµæœã§ã™ã€‚ã€")
            elif final_score <= 90:
                st.write("ã‚¹ãƒ­ãƒƒãƒˆãŒåœæ­¢ã¨åŒæ™‚ã«ã€ã‚¯ãƒªã‚¹ã‚¿ãƒ«ãŒçˆ†ç™ºçš„ãªè¼ãã‚’æ”¾ã¤ã€‚ç”»é¢ã¯é‡‘è‰²ã«æŸ“ã¾ã‚Šã€è¯ã‚„ã‹ãªéŸ³æ¥½ãŒé«˜é³´ã‚‹ã€‚")
                st.write("ã€é‡‘è‰²ã®å…‰ã€è¯ã‚„ã‹ãªéŸ³æ¥½ã€ãã—ã¦é«˜å¾—ç‚¹ã€‚ã‚ãªãŸã®ã‚¹ã‚³ã‚¢ã¯ç«‹æ´¾ã§ã™ãŒã€ãƒ¢ãƒãƒ«ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ã¾ã ä¸Šä½ã®ç©ºå¸­ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚ã€")
            else:
                st.write("çµµæŸ„ãŒå®‡å®™èˆ¹ã®å¤§è‰¦éšŠã«å¤‰åŒ–ã—ã€è‰¦éšŠãŒä¸€æ–‰ã«ç™ºå…‰ã™ã‚‹ã€‚è™¹è‰²ã®ã‚ªãƒ¼ãƒ­ãƒ©ãŒèƒŒæ™¯ã‚’åŒ…ã¿è¾¼ã¿ã€å£®éº—ãªå…‰æ™¯ãŒåºƒãŒã£ãŸã€‚")
                st.write("ã€è‰¦éšŠã®è¼ãã¯ç¾ã—ã„ã§ã™ãŒã€ã‚ãªãŸã®ã‚¹ã‚³ã‚¢ã¯ã•ã‚‰ã«ãã‚Œã‚’è¶…ãˆã‚‹å£®éº—ã•ã§ã™ã€‚ãƒ¢ãƒãƒ«ãƒ³ã¯ã“ã‚Œä»¥ä¸Šã®è¨€è‘‰ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã¾ã›ã‚“â€¦â€¦çã—ã„ã“ã¨ã§ã™ã€‚ã€")
            
            # ãƒ—ãƒ¬ã‚¤å›æ•°ã‚’å¢—ã‚„ã™
            st.session_state["play_count"] += 1
            st.success("ãƒ—ãƒ¬ã‚¤ã—ã¾ã—ãŸï¼æ¬¡ã®æ—¥ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚")
    elif st.session_state["play_count"] >= 4:
            st.error("æœ¬æ—¥ã®ãƒ—ãƒ¬ã‚¤å›æ•°ã‚’è¶…ãˆã¾ã—ãŸã€‚")

    # Streamlitã‚¢ãƒ—ãƒªã¨ã—ã¦å®Ÿè¡Œ
    if __name__ == "__main__":
        hologram_slot()
